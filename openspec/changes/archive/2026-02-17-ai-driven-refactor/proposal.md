# ai-driven 框架重构 Proposal

## 问题描述

经过深度分析，发现 ai-driven 框架存在以下核心问题需要修复：

### 1. 工作区配置完全无效（严重）

**问题**：框架脚本只读取 ai-driven 根目录的 `.workspace.env`，工作区自己的配置文件从未被读取。

**影响**：工作区无法自定义任何配置，注释的配置项形同虚设。

### 2. 同步机制会覆盖用户修改（中等）

**问题**：`sync-space.sh` 直接覆盖文件，没有备份或合并机制。

**影响**：用户自定义的 `team.md` 或 `ai-driven.mdc` 可能丢失。

### 3. 路径推导脆弱（中等）

**问题**：依赖目录层级而非配置文件，目录结构变化时脚本可能失败。

**影响**：框架的可移植性和健壮性降低。

## 修复方案

### 1. 修复工作区配置读取

在 `common.sh` 中添加工作区 `.workspace.env` 的读取逻辑，实现配置覆盖机制。

### 2. 改进同步机制

实现备份+diff 机制，而非直接覆盖用户文件。

### 3. 强化路径推导

使用配置文件或环境变量明确指定路径，减少对目录层级的依赖。

## 预期产出

1. 修改 `common.sh` - 添加工作区配置读取
2. 修改 `sync-space.sh` - 改进同步机制
3. 修改 `init-space.sh` - 确保 OpenSpec 在 setup 时可用（已在 setup-global 安装）
4. 更新文档 - 说明配置覆盖机制

## 验证方式

1. 重新运行 setup-global.sh 验证框架初始化
2. 创建新 workspace 验证配置读取
3. 运行 sync-space.sh 验证不覆盖用户修改
