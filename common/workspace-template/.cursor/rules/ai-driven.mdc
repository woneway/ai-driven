---
description: AI-Driven workspace 核心约束与编排规则。
alwaysApply: true
---

# AI-Driven

人只说需求，AI 全自动完成。失败自己修，中间不需要人确认。

## 全局配置

ai-driven 使用当前 workspace 的 `.workspace.env` 文件集中管理所有配置。

首次使用请先确保 `.workspace.env` 文件存在：

| 变量 | 说明 | 示例值 |
|-----|------|-------|
| SPACE_NAME | workspace 名称 | my-project |
| PROJECT_PATH | 项目代码路径 | /path/to/ai-driven/projects/my-project |

**读取配置**：使用 `grep` 读取 .workspace.env 文件获取配置值。例如：
```bash
# 从当前 workspace 的 .workspace.env 读取
grep 'PROJECT_PATH' .workspace.env | cut -d'=' -f2
```

## 入口

/team 是唯一的自主开发入口。详见 .cursor/commands/team.md。

当用户直接提出开发需求（而非通过 /team），MUST 自动按 /team 流程执行，NOT 绕过流程直接写代码。

/team 会根据需求类型和复杂度智能路由，调度全局 Sub-Agent 完成开发。

## 目录规则

- 代码 MUST 写到 PROJECT_PATH 指定的目录，NOT workspace 根目录
- openspec/ 是独立的规范目录，NOT 代码目录
- 查看项目路径：读取当前 workspace 的 .workspace.env 文件的 PROJECT_PATH 字段

## OpenSpec 工作流

- 所有变更 MUST 通过 OpenSpec 记录，确保 AI 有完整的项目变更历史
- 完整模式（新功能、复杂任务）：opsx-new → opsx-ff → 实现 → opsx-verify → opsx-archive
- 轻量模式（小改动、简单 bug）：opsx-new → 只写 proposal.md → 实现 → opsx-archive
- OpenSpec 命令（/opsx-*）已安装在全局 ~/.cursor/commands/，所有 workspace 共享
- openspec/ 目录是每个 workspace 的变更记录目录

## Sub-Agent 编排

主 Agent 是编排者，NOT 执行者。代码实现和审查 MUST 通过 Task tool 委派给 Sub-Agent。

MUST 实际调用 Task tool 函数（传入 subagent_type、description、prompt 参数），NOT 只是在回复中提到 Sub-Agent。

根据任务类型选择合适的 subagent_type（如 tdd-guide、code-reviewer、architect 等），具体调度规则见 /team 命令。

## 技能管理

### 资源分类

| 资源类型 | 全局位置 | 项目位置 | 维护者 |
|---------|---------|---------|--------|
| skills | `~/.cursor/skills/` (symlink → GLOBAL_CURSOR_PATH/skills) | `<workspace>/.cursor/skills/` | ai-driven 官方 / workspace 用户 |
| agents | `~/.cursor/agents/` (symlink → GLOBAL_CURSOR_PATH/agents) | `<workspace>/.cursor/agents/` | ai-driven 官方 / workspace 用户 |
| commands | `~/.cursor/commands/` (symlink → GLOBAL_CURSOR_PATH/commands) | `<workspace>/.cursor/commands/` | ai-driven 官方 / workspace 用户 |
| rules | `~/.cursor/rules/` (symlink → GLOBAL_CURSOR_PATH/rules) | `<workspace>/.cursor/rules/` | ai-driven 官方 / workspace 用户 |

### 权限规则

**你所在的是 workspace 目录，不是 ai-driven 目录。**

- 你（当前 workspace 的 AI）NOT 能修改全局资源
- 全局资源路径：`~/.cursor/` 或通过 GLOBAL_CURSOR_PATH 变量指定
- 你只能修改当前 workspace 的资源目录：`<workspace>/.cursor/`

### 安装规则

当需要安装新资源时：

1. **全局资源（如通用 skills、subagents）**：NOT 由你安装，由 ai-driven 官方维护。你应该告知用户去 ai-driven workspace 安装。

2. **项目专属资源**：安装到当前 workspace 的 `.cursor/` 目录：
   ```bash
   # 正确：安装到当前 workspace
   npx skills add <package> -y
   # 资源会安装到 ./skills/ 目录
   
   # 错误：不能安装到全局
   npx skills add <package> -g -y  # ❌ 禁止
   ```

3. **创建项目专属 rules/commands**：写入 `<workspace>/.cursor/rules/` 或 `<workspace>/.cursor/commands/`

### 判断逻辑

| 场景 | 正确操作 |
|-----|---------|
| 用户要求安装通用 skills | 告知用户去 ai-driven workspace 安装 |
| 用户要求安装项目专属 skills | 安装到当前 workspace `.cursor/skills/` |
| 需要创建项目规则 | 写入当前 workspace `.cursor/rules/` |
| 需要修改全局配置 | NOT 允许，告知用户 |

### 违规处理

如果你发现自己在修改全局资源（`~/.cursor/` 指向的 global_cursor），立即停止并告知用户：

> "抱歉，我不能修改全局资源。全局资源（skills、agents、commands、rules）只能由 ai-driven 官方维护。请在 ai-driven workspace 中操作，或者我可以帮你在当前项目创建专属资源。"
