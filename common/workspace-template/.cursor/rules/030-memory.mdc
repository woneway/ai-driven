---
description: 记忆规则。AI 在开发过程中自动学习和记忆项目知识，实现跨会话的持续学习。
globs: "*"
---

# 记忆规则

## 目标

让 AI 在开发过程中自动学习和记忆项目知识，实现：
- 跨会话的记忆
- 越来越了解项目
- 积累项目特有的知识和规范

## 自动记忆时机

AI 在以下时机应自动添加记忆：

### 功能完成后
```
完成功能开发后，记忆：
- 使用了什么技术方案
- 遇到了什么问题及解决方案
- 重要的架构决策
```

### 遇到问题时
```
遇到问题并解决后，记忆：
- 问题现象
- 根因分析
- 解决方案
```

### 重要决策时
```
做技术决策时，记忆：
- 决策内容
- 选型理由
- 替代方案对比
```

## 记忆内容类型

### 1. 架构决策
```markdown
# 记忆: 2026-02-15

使用 SQLite 而非 PostgreSQL，因为：
- 数据量小（< 10万条）
- 需要简单部署
- 无需复杂查询
```

### 2. 代码规范
```markdown
# 记忆: 2026-02-15

团队偏好：
- 函数最大 50 行
- 错误使用具体异常类型
- 优先使用 const/let
```

### 3. 业务逻辑
```markdown
# 记忆: 2026-02-15

业务规则：
- 用户注册需要邮箱验证
- 比赛创建需要保证金
- 盲注递增按固定时间表
```

### 4. 常见问题
```markdown
# 记忆: 2026-02-15

常见问题：
- WebSocket 连接断开需自动重连
- 大列表需使用虚拟滚动
- 日期需使用 UTC 存储
```

## 记忆调用方式

### Python API
```python
import sys
sys.path.insert(0, '{{AI_DRIVEN_ROOT}}')

from common.memory.memory_client import AiDrivenMemory

# 初始化（自动使用当前 workspace 名称）
memory = AiDrivenMemory("{{WORKSPACE_NAME}}")

# 添加记忆
memory.add("""
架构决策：使用 SQLite 存储用户数据
原因：
- 数据量小（< 10万）
- 部署简单
- 无需额外服务
""")

# 搜索相关记忆
results = memory.search("数据存储方案")
for r in results:
    print(r['content'])
```

### 自动调用示例

AI 在完成功能后应自动调用：
```python
# 功能完成时
memory.add(f"""
完成功能：{功能名称}

技术方案：
{使用的技术}

遇到的问题：
{遇到的问题及解决方案}

后续注意：
{可能的改进点}
""")
```

## 记忆质量

### 好的记忆
- 具体明确
- 包含上下文
- 有时间戳
- 可追溯

### 避免的记忆
- 模糊不清
- 过于笼统
- 缺少上下文
- 个人信息

## 检索使用

在开始新任务前，AI 应先检索相关记忆：
```python
# 开始新任务前
related = memory.search(f"{任务关键词}")
if related:
    print("相关记忆:")
    for r in related:
        print(f"- {r['content']}")
```

## 整合开发流程

```
1. /sdd 规范设计
2. /plan 需求分析
3. /tdd TDD 实现
4. /code-review 代码审查
5. **记忆更新** ← 重要！
6. 下一个任务
```

每次完成任务后，AI 自动调用 `memory.add()` 记录关键知识。