---
description: AI-Driven 管理命令。定义同步、分析、升级等管理操作。
globs: "*"
---
# AI-Driven 管理命令

这些命令用于管理 ai-driven 本身，包括同步、升级等操作。

## 命令列表

### `/ai-driven:sync`

**同步所有 workspace 的规则和技能**。

```
用法: /ai-driven:sync
```

将 `common/` 中的最新规则和技能同步到所有 workspace。

### `/ai-driven:analyze`

**分析所有 workspace 的 feedback，制定升级计划**。

```
用法: /ai-driven:analyze
```

1. 读取所有 workspace 的 `.homunculus/insights/lessons-learned.md`
2. 汇总分析需要升级的能力
3. 生成升级计划
4. 等待用户确认后执行

**错误处理**：
- 如果 workspace 目录不存在，跳过并警告
- 如果 insights 文件不存在，记录为空

### `/ai-driven:upgrade`

**执行升级计划**。

```
用法: /ai-driven:upgrade
```

根据 `/ai-driven:analyze` 生成的计划：
- 添加新技能
- 更新现有规则
- 同步到所有 workspace

### `/ai-driven:status`

**查看 ai-driven 状态**。

```
用法: /ai-driven:status
```

显示：
- 管理的 workspace 数量
- 各 workspace 的最后活动时间
- 待处理的 feedback 数量

---

## /team

**Lead Agent 编排多个子 Agent 完成任务**。

```
用法: /team <任务描述>
```

### 工作流

1. 规划 → `/planner`
2. 执行 → `/tdd-guide`
3. 验证 → `/code-reviewer`

### Agents

```
/planner  /tdd-guide  /code-reviewer  /security-reviewer
```

### 参考

- [hamzafer/cursor-commands](https://github.com/hamzafer/cursor-commands)

---

## 升级流程

```
1. 用户: /ai-driven:analyze

2. AI:
   - 读取 .space-config 获取 workspace 列表（CODE_ROOTS 字段）
   - 遍历每个 workspace，读取 .homunculus/insights/lessons-learned.md
   - 汇总分析，生成升级建议

3. AI 输出:
   ## 升级建议

   ### 需要添加的技能
   - iOS 调试技能（来自 poker_space）
   - Java 测试技能（来自 asset_space）

   ### 需要更新的规则
   - project.mdc：添加新的质量门禁

   ### 建议
   - [计划 1]: 添加 iOS 技能库
   - [计划 2]: 更新所有 workspace 的规则

4. 用户确认: "好的，执行计划 1"

5. AI: /ai-driven:upgrade
   - 创建新技能
   - 更新规则
   - 同步到相关 workspace
```

## 自动反馈收集

AI 在执行 `/team` 命令时，会自动识别并记录：

```markdown
# 反馈给 AI-Driven

## 需要添加的能力
- [2026-02-14] 需要 iOS 特有的调试技能 - poker_space
- [2026-02-14] 需要更好的 Java 测试框架支持 - asset_space

## 建议
- [2026-02-14] 考虑添加数据库迁移相关的技能
```

记录到 `.homunculus/insights/lessons-learned.md`

## 实施细节

### `/ai-driven:analyze` 实现

```bash
# 1. 读取当前目录的 .space-config 获取 workspace 信息
source .space-config

# 2. 遍历收集 lessons-learned
all_lessons=()
for code_root in $CODE_ROOTS; do
    lessons_file="$code_root/.homunculus/insights/lessons-learned.md"
    if [ -f "$lessons_file" ]; then
        all_lessons+=("$lessons_file")
    fi
done

# 3. 分析和汇总
analysis=$(analyze_lessons "${all_lessons[@]}")

# 4. 生成建议
echo "$analysis"
```

**错误处理**：
- CODE_ROOTS 未定义：提示用户先初始化 workspace
- .homunculus 目录不存在：跳过该 workspace
- lessons-learned.md 为空：跳过并记录为"无反馈"

### `/ai-driven:upgrade` 实现

```bash
# 1. 读取升级计划（由 analyze 生成）
PLAN_FILE="config/upgrade-plan.md"
if [ ! -f "$PLAN_FILE" ]; then
    echo "错误: 未找到升级计划，请先运行 /ai-driven:analyze"
    exit 1
fi

# 2. 解析计划（简单按行解析）
# 格式: ACTION|TYPE|NAME|TARGET
while IFS='|' read -r action type name target; do
    [ "$action" = "#" ] && continue  # 跳过注释
    
    case "$action" in
        CREATE_SKILL)
            # 创建新技能
            mkdir -p "$HOME/.cursor/skills/$name"
            # ... 复制模板
            ;;
        UPDATE_RULE)
            # 更新规则
            # ...
            ;;
        SYNC)
            # 同步到 workspace
            # ...
            ;;
    esac
done < "$PLAN_FILE"
```

**错误处理**：
- PLAN_FILE 不存在：报错并提示运行 analyze
- 权限不足：提示用户检查权限
- 目标文件已存在：备份后再覆盖
